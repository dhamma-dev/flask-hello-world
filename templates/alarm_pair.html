{% extends "base.html" %}
{% block title %}Alarm {{ alarm_id[:16] }}… – Alarm Webhook{% endblock %}
{% block content %}
  <h1>Alarm {{ alarm_id }}</h1>
  <p class="muted">All events for this alarm (RAISED / CLEARED pairing)</p>
  <table>
    <thead>
      <tr>
        <th>Received at</th>
        <th>State</th>
        <th>Rule</th>
        <th>Raised time</th>
        <th>Cleared time</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for e in events %}
      <tr>
        <td class="muted">{{ e.received_at[:19] if e.received_at else '-' }}</td>
        <td><span class="badge badge-{{ e.state|lower }}">{{ e.state }}</span></td>
        <td>{{ e.payload.get('rule') or '-' }}</td>
        <td class="muted">{{ (e.payload.get('raisedTime') or '-')[:19] }}</td>
        <td class="muted">{{ (e.payload.get('clearedTime') or '-')[:19] }}</td>
        <td><a href="/event/{{ e.id }}">JSON</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <h2>Payloads</h2>
  {% for e in events %}
  <details>
    <summary>{{ e.state }} at {{ e.received_at[:19] if e.received_at else '-' }}</summary>
    <pre>{{ e.payload | tojson(indent=2) }}</pre>
  </details>
  {% endfor %}
{% endblock %}
